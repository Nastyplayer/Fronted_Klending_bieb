{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\jftal\\\\WebstormProjects\\\\KLEDING_BIEB\\\\src\\\\context\\\\AuthContext.js\",\n  _s = $RefreshSig$();\nimport { createContext, useEffect, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport axios from \"axios\";\nimport jwtDecode from \"jwt-decode\";\n\n//\n// export const AuthContext = createContext({});\n//\n// function AuthContextProvider({ children }) {\n//     const [isAuth, toggleIsAuth] = useState(false);\n//     const [username, setUsername] = useState(\"\");\n//     const navigate = useNavigate();\n//     const [status ,setStatus] = useState(\"pending\")\n//\n//\n//     useEffect(()=> {\n//\n//         const storedToken = localStorage.getItem('token')\n//\n//         if ( storedToken ) {\n//             const decodedToken = jwtDecode(storedToken)\n//             if ( Math.floor( Date.now() / 1000 ) < decodedToken.exp) {\n//                 console.log( \"Gebruiker blijft ingelogd ðŸ”“\" )\n//                 setUsername(decodedToken.sub)\n//                 void login()\n//             } else  {\n//                 console.log( \"De token is verlopen\" )\n//                 localStorage.removeItem( 'token' )\n//             }    } else {\n//\n//             setStatus(\"done\")\n//             toggleIsAuth(false)\n//             navigate(\"/\")\n//         }},[])\n//\n//\n//     const noAuthAxios= axios.create( {\n//         baseURL : 'http://localhost:8083'\n//     });\n//\n//     const jwToken = localStorage.getItem('token')\n//     const authAxios = axios.create( {\n//         baseURL : 'http://localhost:8083',\n//         headers : {\n//             Authorization: `Bearer ${jwToken}`,\n//         },\n//     });\n//\n//     function login() {\n//         toggleIsAuth(true);\n//         setStatus(\"done\");\n//     }\n//\n//     function logout() {\n//         console.log('Gebruiker is uitgelogd!');\n//         localStorage.removeItem('token');\n//         toggleIsAuth(false);\n//         navigate('/');\n//     }\n//\n//     const contextData = {\n//         authAxios,\n//         noAuthAxios,\n//         username,\n//         setUsername,\n//         isAuth: isAuth,\n//         login,\n//         logout,\n//         jwToken\n//     };\n//\n//     return (\n//         <AuthContext.Provider value={contextData}>\n//             {status === \"done\" ? children :  <p>Loading...</p>}\n//         </AuthContext.Provider>\n//     );\n// }\n//\n// export default AuthContextProvider;\n//\n// //\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const AuthContext = /*#__PURE__*/createContext({});\nfunction AuthContextProvider(_ref) {\n  _s();\n  let {\n    children\n  } = _ref;\n  //   const [auth, toggleIsAuth] = useState ({\n\n  const [auth, setAuth] = useState({\n    isAuth: false,\n    user: null,\n    status: \"pending\"\n  });\n  const navigate = useNavigate();\n\n  //\n  // useEffect(() => {\n  //         const storedToken = localStorage.getItem(\"token\");\n  //         if (storedToken) {\n  //             //  used fetchUserData\n  //             const decodedToken = jwtDecode(storedToken)\n  //             if (Math.floor(Date.now() / 1000) < decodedToken.exp) {\n  //                 void fetchUserData(storedToken, decodedToken.sub);\n  //             }\n  //         } else {\n  //             // disable token set status done and render app\n  //             setAuth({\n  //                 ...auth,\n  //                 isAuth: false,\n  //                 user: null,\n  //                 status: 'done',\n  //             });\n  //         }\n  //     }, []\n  // );\n\n  function login(token) {\n    localStorage.setItem('token', token);\n    const decodedToken = jwtDecode(token);\n    console.log(decodedToken);\n    void fetchUserData(token, decodedToken.sub, \"/account\");\n  }\n\n  //\n  //\n  //\n  //     // function login(email) {\n  //     //     //  toggleIsAuth(  {isAuth: true, user: email})\n  //     //     setAuth(  {isAuth: true, user: email})\n  //     //     console.log(\"Gebruiker is ingelogd met emaildres : \", email);\n  //     //     navigate ('/account');\n  //     // }\n  async function fetchUserData(token, sub, redirect) {\n    try {\n      const response = await axios.get(`http://localhost:8083/users/${sub}`, {\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${token}`\n        }\n      });\n      console.log(response.data);\n      setAuth({\n        ...auth,\n        isAuth: true,\n        user: {\n          username: response.data.username,\n          authority: response.data.authorities[0].authority\n        },\n        status: \"done\"\n      });\n      // refreshes other than account page, the page will refresh it\n      if (redirect) {\n        navigate(redirect);\n      }\n    } catch (e) {\n      console.error(e);\n      setAuth({\n        ...auth,\n        status: \"done\"\n      });\n    }\n  }\n  function logout() {\n    setAuth({\n      isAuth: false,\n      user: null,\n      status: \"pending\"\n    });\n    localStorage.removeItem(\"token\");\n    console.log(\"Gebruiker is uitgelogd!\");\n    navigate('/');\n  }\n  const data = {\n    login: login,\n    logout: logout,\n    isAuth: auth.isAuth,\n    user: auth.user,\n    status: auth.status\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: data,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 184,\n    columnNumber: 9\n  }, this);\n}\n_s(AuthContextProvider, \"OPgoCqn2EJm8Cajpo41mvZ9isjw=\", false, function () {\n  return [useNavigate];\n});\n_c = AuthContextProvider;\nexport default AuthContextProvider;\n\n// //{auth.status === \"done\" ? children : <p>Loading...</p>}\nvar _c;\n$RefreshReg$(_c, \"AuthContextProvider\");","map":{"version":3,"names":["createContext","useEffect","useState","useNavigate","axios","jwtDecode","jsxDEV","_jsxDEV","AuthContext","AuthContextProvider","_ref","_s","children","auth","setAuth","isAuth","user","status","navigate","login","token","localStorage","setItem","decodedToken","console","log","fetchUserData","sub","redirect","response","get","headers","Authorization","data","username","authority","authorities","e","error","logout","removeItem","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/jftal/WebstormProjects/KLEDING_BIEB/src/context/AuthContext.js"],"sourcesContent":["import {createContext, useEffect, useState} from 'react';\r\nimport {useNavigate} from 'react-router-dom';\r\n\r\nimport axios from \"axios\";\r\nimport jwtDecode from \"jwt-decode\";\r\n\r\n//\r\n// export const AuthContext = createContext({});\r\n//\r\n// function AuthContextProvider({ children }) {\r\n//     const [isAuth, toggleIsAuth] = useState(false);\r\n//     const [username, setUsername] = useState(\"\");\r\n//     const navigate = useNavigate();\r\n//     const [status ,setStatus] = useState(\"pending\")\r\n//\r\n//\r\n//     useEffect(()=> {\r\n//\r\n//         const storedToken = localStorage.getItem('token')\r\n//\r\n//         if ( storedToken ) {\r\n//             const decodedToken = jwtDecode(storedToken)\r\n//             if ( Math.floor( Date.now() / 1000 ) < decodedToken.exp) {\r\n//                 console.log( \"Gebruiker blijft ingelogd ðŸ”“\" )\r\n//                 setUsername(decodedToken.sub)\r\n//                 void login()\r\n//             } else  {\r\n//                 console.log( \"De token is verlopen\" )\r\n//                 localStorage.removeItem( 'token' )\r\n//             }    } else {\r\n//\r\n//             setStatus(\"done\")\r\n//             toggleIsAuth(false)\r\n//             navigate(\"/\")\r\n//         }},[])\r\n//\r\n//\r\n//     const noAuthAxios= axios.create( {\r\n//         baseURL : 'http://localhost:8083'\r\n//     });\r\n//\r\n//     const jwToken = localStorage.getItem('token')\r\n//     const authAxios = axios.create( {\r\n//         baseURL : 'http://localhost:8083',\r\n//         headers : {\r\n//             Authorization: `Bearer ${jwToken}`,\r\n//         },\r\n//     });\r\n//\r\n//     function login() {\r\n//         toggleIsAuth(true);\r\n//         setStatus(\"done\");\r\n//     }\r\n//\r\n//     function logout() {\r\n//         console.log('Gebruiker is uitgelogd!');\r\n//         localStorage.removeItem('token');\r\n//         toggleIsAuth(false);\r\n//         navigate('/');\r\n//     }\r\n//\r\n//     const contextData = {\r\n//         authAxios,\r\n//         noAuthAxios,\r\n//         username,\r\n//         setUsername,\r\n//         isAuth: isAuth,\r\n//         login,\r\n//         logout,\r\n//         jwToken\r\n//     };\r\n//\r\n//     return (\r\n//         <AuthContext.Provider value={contextData}>\r\n//             {status === \"done\" ? children :  <p>Loading...</p>}\r\n//         </AuthContext.Provider>\r\n//     );\r\n// }\r\n //\r\n// export default AuthContextProvider;\r\n//\r\n// //\r\nexport const AuthContext = createContext({}) ;\r\n\r\nfunction AuthContextProvider({children}) {\r\n    //   const [auth, toggleIsAuth] = useState ({\r\n\r\n    const [auth, setAuth] = useState({\r\n        isAuth: false,\r\n        user: null,\r\n        status: \"pending\",\r\n    });\r\n    const navigate = useNavigate();\r\n\r\n\r\n    //\r\n    // useEffect(() => {\r\n    //         const storedToken = localStorage.getItem(\"token\");\r\n    //         if (storedToken) {\r\n    //             //  used fetchUserData\r\n    //             const decodedToken = jwtDecode(storedToken)\r\n    //             if (Math.floor(Date.now() / 1000) < decodedToken.exp) {\r\n    //                 void fetchUserData(storedToken, decodedToken.sub);\r\n    //             }\r\n    //         } else {\r\n    //             // disable token set status done and render app\r\n    //             setAuth({\r\n    //                 ...auth,\r\n    //                 isAuth: false,\r\n    //                 user: null,\r\n    //                 status: 'done',\r\n    //             });\r\n    //         }\r\n    //     }, []\r\n    // );\r\n\r\n\r\n    function login(token) {\r\n        localStorage.setItem('token', token);\r\n        const decodedToken = jwtDecode(token);\r\n        console.log(decodedToken)\r\n        void fetchUserData(token, decodedToken.sub, \"/account\");\r\n    }\r\n\r\n//\r\n//\r\n//\r\n//     // function login(email) {\r\n//     //     //  toggleIsAuth(  {isAuth: true, user: email})\r\n//     //     setAuth(  {isAuth: true, user: email})\r\n//     //     console.log(\"Gebruiker is ingelogd met emaildres : \", email);\r\n//     //     navigate ('/account');\r\n//     // }\r\n    async function fetchUserData(token, sub, redirect) {\r\n        try {\r\n\r\n            const response = await axios.get(`http://localhost:8083/users/${sub}`, {\r\n                headers: {\r\n                    \"Content-Type\": \"application/json\",\r\n                    Authorization: `Bearer ${token}`,\r\n                }\r\n            })\r\n\r\n            console.log(response.data)\r\n            setAuth({\r\n                ...auth,\r\n                isAuth: true,\r\n                user: {\r\n                    username: response.data.username,\r\n                    authority: response.data.authorities[0].authority\r\n                },\r\n                status: \"done\"\r\n            });\r\n            // refreshes other than account page, the page will refresh it\r\n            if (redirect) {\r\n                navigate(redirect);\r\n            }\r\n        } catch (e) {\r\n            console.error(e);\r\n            setAuth({\r\n                ...auth,\r\n                status: \"done\",\r\n            })\r\n        }\r\n    }\r\n\r\n    function logout() {\r\n        setAuth( {isAuth: false, user: null,\r\n            status: \"pending\",});\r\n        localStorage.removeItem(\"token\");\r\n        console.log(\"Gebruiker is uitgelogd!\");\r\n        navigate ('/');\r\n    }\r\n\r\n    const data = {\r\n        login: login,\r\n        logout: logout,\r\n        isAuth: auth.isAuth,\r\n        user: auth.user,\r\n        status: auth.status,\r\n    }\r\n\r\n    return (\r\n        <AuthContext.Provider value={data}>\r\n            {children}\r\n        </AuthContext.Provider>\r\n    );\r\n}\r\nexport default AuthContextProvider;\r\n\r\n// //{auth.status === \"done\" ? children : <p>Loading...</p>}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}